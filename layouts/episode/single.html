{{ define "main" }}

  <div class="flex flex-wrap -mx-4 mb-6">
    <div class="w-full px-4">
      <h1 class="text-3xl font-bold mb-2">
        {{ if and (isset .Site.Params "episode_number_style") (.Params.episode) }}
          {{ if eq .Site.Params.episode_number_style "parens" }}
            {{ title .Title }} ({{ with .Site.Params.episode_number_prefix }}{{ . }}{{ end }}{{ .Params.episode }})
          {{ else if eq .Site.Params.episode_number_style "brackets" }}
            {{ title .Title }} [{{ with .Site.Params.episode_number_prefix }}{{ . }}{{ end }}{{ .Params.episode }}]
          {{ else if eq .Site.Params.episode_number_style "dash" }}
            {{ title .Title }} - {{ with .Site.Params.episode_number_prefix }}{{ . }}{{ end }}{{ .Params.episode }}
          {{ else }}
            {{ title .Title }}
          {{ end }}
        {{ else }}
          {{ title .Title }}
        {{ end }}
      </h1>
      {{- if ne $.Params.upcoming true -}}
        <small>Posted on {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "episode-metadata.html" .}}</small>
      {{- else -}}
        <small>Scheduled for {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "episode-metadata.html" .}}</small>
      {{- end -}}
    </div>
  </div>

  {{ if isset .Params "episode_banner" }}
    {{ if ne .Params.episode_banner "" }}
      <div class="flex flex-wrap -mx-4 mb-6">
        <div class="w-full px-4">
          <img src="{{ .Params.episode_banner | absURL }}" class="w-full h-auto rounded-lg shadow"/>
        </div>
      </div>
      <div class="flex flex-wrap -mx-4 mb-6">
        <div class="w-full px-4">
          {{ .Description | markdownify }}
        </div>
      </div>
    {{ end }}
  {{ else }}
    <!-- begin square row -->
    {{- if isset .Params "episode_image" -}}
      {{- if ne .Params.episode_image "" -}}
        <div class="flex flex-wrap -mx-4 mb-6">
          <div class="w-full md:w-1/4 px-4 mb-4 md:mb-0">
            <img src="{{ .Params.episode_image | absURL }}" class="w-full h-auto rounded-lg shadow"/>
          </div>
          <div class="w-full md:w-3/4 px-4">
            {{ .Description | markdownify }}
          </div>
        </div>
      {{- end -}}
    {{- else -}}
      <div class="flex flex-wrap -mx-4 mb-6">
        <div class="w-full px-4">
          {{ .Description | markdownify }}
        </div>
      </div>
    {{- end -}}
    <!-- end square row -->
  {{ end }}

  {{- with .Params.podcast_file -}}
    {{- if ne $.Params.upcoming true -}}
      <div class="flex flex-wrap -mx-4 mb-6">
        <div class="w-full">
          <audio id="player2" class="w-full" controls preload="none" width="100%">
            <source src="{{ $.Site.Params.media_prefix }}{{ . }}" type="audio/mp3">
          </audio>
        </div>
      </div>
    {{- end -}}
  {{- end -}}

  {{- with .Params.youtube -}}
    {{- if ne $.Params.upcoming true -}}
      <div class="flex flex-wrap -mx-4 mb-6">
        <div class="w-full px-4">
          <div class="w-full aspect-[16/9]">
            <iframe class="w-full h-full rounded-lg shadow-lg" src="//www.youtube.com/embed/{{ . }}" allowfullscreen></iframe>
          </div>
        </div>
      </div>
    {{- end -}}
  {{- end -}}

  <!-- transcript POC begin-->
  {{- with .Params.transcript -}}
    <div class="flex flex-wrap -mx-4 mb-6">
      <div class="w-full px-4">
        <p>
          <!-- <a class="btn btn-default" href="/"><i class="fab fa-spotify"></i>&nbsp;Spotify</a> -->
          <button class="hide_transcript inline-flex items-center px-4 py-2 bg-castanet-primary-200 text-castanet-primary-800 rounded hover:bg-castanet-primary-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">Hide Transcript</button>
          <button class="show_transcript inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">Display Transcript</button>
        </p>
      </div>
    </div>
    <div class="flex flex-wrap -mx-4 mb-6 transcript">
      <div class="w-full px-4">
        <h2 class="text-2xl font-bold mb-4">Transcript</h2>
        {{ (readFile .) | markdownify}}
      </div>
    </div>
  {{- end -}}
  <!-- transcript POC end -->

  <div class="flex flex-wrap -mx-4 mb-6">
    <div class="w-full px-4 bg-castanet-primary-50 dark:bg-castanet-primary-900 rounded-lg shadow">
      <h2 class="text-2xl font-bold mb-4">Show Notes</h2>
      <div class="prose dark:prose-invert max-w-none mb-12 mx-auto px-4 py-5 bg-castanet-primary-100 dark:bg-castanet-primary-900 rounded-lg shadow">
        {{ .Content }}
      </div>
    </div>
  </div>

  {{ with .Params.guests }}
    <div class="mx-auto px-4 bg-castanet-primary-50 dark:bg-castanet-primary-900 rounded-lg shadow">
      <div class="flex flex-wrap -mx-4 mb-6 ">
        <div class="w-full px-4">
          <h2 class="text-3xl font-bold mb-4">Guests</h2>
        </div>
      </div>
      {{ range $name := . }}
        {{ $.Scratch.Set "person" $name }}
        {{- range where $.Site.Pages "Type" "guest" -}}
          {{- if eq .File.BaseFileName ($.Scratch.Get "person") -}}
            <div class="flex flex-wrap mx-auto mb-6 py-5 bg-castanet-primary-100 dark:bg-castanet-primary-900 rounded-lg shadow">
              <div class="w-full md:w-1/4 px-4 mb-4 md:mb-0">
                {{- if and (isset .Params "thumbnail") (ne .Params.thumbnail "") -}}
                  {{- if (eq (slicestr .Params.thumbnail 0 4) "http") -}}
                    <img alt="{{ .Title }}" src="{{ .Params.thumbnail }}" class="w-full h-auto rounded-lg shadow">
                  {{- else -}}
                    <img alt="{{ .Title }}" src="{{ .Params.thumbnail | absURL}}" class="w-full h-auto rounded-lg shadow">
                  {{- end -}}
                {{- else -}}
                  <img alt="{{ .Title }}" src="{{ "img/guest/default-guest.png" | absURL }}" class="w-full h-auto rounded-lg shadow" width="250px"/>
                {{- end -}}
              </div>
              <div class="w-full md:w-3/4 px-4">
                <h2 class="text-3xl font-bold mb-4"><a href = "{{(printf "guest/%s/" .File.BaseFileName) | absURL }}">{{ .Title }}</a> {{ with .Params.Pronouns }}({{ . }}){{ end }}</h2>
                {{ .Content }}
                {{- with .Params.Website -}}
                  <a href="{{ . }}" target="_blank">
                    <i class="fas fa-home fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Twitter -}}
                  <a href="https://twitter.com/{{ . }}" target="_blank">
                    <i class="fab fa-twitter-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.GitHub -}}
                  <a href="https://github.com/{{ . }}" target="_blank">
                    <i class="fab fa-github-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.LinkedIn -}}
                  <a href="https://www.linkedin.com/in/{{ . }}/" target="_blank">
                    <i class="fab fa-linkedin fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Facebook -}}
                  <a href="https://www.facebook.com/{{ . }}" target="_blank">
                    <i class="fab fa-facebook-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Pinterest -}}
                  <a href="https://www.pinterest.com/{{ . }}" target="_blank">
                    <i class="fab fa-pinterest-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Instagram -}}
                  <a href="https://www.instagram.com/{{ . }}" target="_blank">
                    <i class="fab fa-instagram fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.YouTube -}}
                  <a href="https://www.youtube.com/{{ . }}" target="_blank">
                    <i class="fab fa-youtube-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Twitch -}}
                  <a href="https://twitch.tv/{{ . }}" target="_blank">
                    <i class="fab fa-twitch fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Mastodon -}}
                  <a href="{{ . }}" target="_blank">
                    <i class="fab fa-mastodon fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Threads -}}
                  <a href="https://threads.net/@{{ . }}" target="_blank">
                    <i class="fab fa-square-threads fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Bluesky -}}
                  <a href="https://bsky.app/profile/{{ . }}" target="_blank">
                    <i class="fab fa-square-bluesky fa-2x"></i>
                  </a>
                {{- end -}}
              </div>
            </div>
          {{- end -}}
        {{- end -}}
      {{ end }}
    </div>
  {{ end }}

  {{ with .Params.hosts }}
    <div class="mx-auto px-5 pb-5 bg-castanet-primary-50 dark:bg-castanet-primary-900 rounded-lg shadow">
      <div class="flex flex-wrap -mx-4 mb-6">
        <div class="w-full px-4">
          <h2 class="text-3xl font-bold mb-4">Hosts</h2>
        </div>
      </div>
      {{ range $name := . }}
        {{ $.Scratch.Set "person" $name }}
        {{- range where $.Site.Pages "Type" "host" -}}
          {{- if eq .File.BaseFileName ($.Scratch.Get "person") -}}
            <div class="flex flex-wrap mx-auto mb-6 py-5 bg-castanet-primary-100 dark:bg-castanet-primary-900 rounded-lg shadow">
              <div class="w-full md:w-1/4 px-4 mb-4 md:mb-0">
                {{- if and (isset .Params "thumbnail") (ne .Params.thumbnail "") -}}
                  {{- if (eq (slicestr .Params.thumbnail 0 4) "http") -}}
                    <img alt="{{ .Title }}" src="{{ .Params.thumbnail }}" class="w-full h-auto rounded-lg shadow">
                  {{- else -}}
                    <img alt="{{ .Title }}" src="{{ .Params.thumbnail | absURL}}" class="w-full h-auto rounded-lg shadow">
                  {{- end -}}
                {{- else -}}
                  <img alt="{{ .Title }}" src="{{ "img/host/default-host.png" | absURL }}" class="w-full h-auto rounded-lg shadow" width="250px"/>
                {{- end -}}
              </div>
              <div class="w-full md:w-3/4 px-4">
                <h2 class="text-3xl font-bold mb-4"><a href = "{{(printf "host/%s/" .File.BaseFileName) | absURL }}">{{ .Title }}</a> {{ with .Params.Pronouns }}({{ . }}){{ end }}</h2>
                {{ .Content }}
                {{- with .Params.Website -}}
                  <a href="{{ . }}" target="_blank">
                    <i class="fas fa-home fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Twitter -}}
                  <a href="https://twitter.com/{{ . }}" target="_blank">
                    <i class="fab fa-twitter-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.GitHub -}}
                  <a href="https://github.com/{{ . }}" target="_blank">
                    <i class="fab fa-github-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.LinkedIn -}}
                  <a href="https://www.linkedin.com/in/{{ . }}/" target="_blank">
                    <i class="fab fa-linkedin fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Facebook -}}
                  <a href="https://www.facebook.com/{{ . }}" target="_blank">
                    <i class="fab fa-facebook-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Pinterest -}}
                  <a href="https://www.pinterest.com/{{ . }}" target="_blank">
                    <i class="fab fa-pinterest-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Instagram -}}
                  <a href="https://www.instagram.com/{{ . }}" target="_blank">
                    <i class="fab fa-instagram fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.YouTube -}}
                  <a href="https://www.youtube.com/{{ . }}" target="_blank">
                    <i class="fab fa-youtube-square fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Twitch -}}
                  <a href="https://twitch.tv/{{ . }}" >
                    <i class="fab fa-twitch fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Mastodon -}}
                  <a href="{{ . }}" target="_blank">
                    <i class="fab fa-mastodon fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Threads -}}
                  <a href="https://threads.net/@{{ . }}" target="_blank">
                    <i class="fab fa-square-threads fa-2x"></i>
                  </a>
                {{- end -}}
                {{- with .Params.Bluesky -}}
                  <a href="https://bsky.app/profile/{{ . }}" target="_blank">
                    <i class="fab fa-square-bluesky fa-2x"></i>
                  </a>
                {{- end -}}
              </div>
            </div>
          {{- end -}}
        {{- end -}}
      {{ end }}
    </div>
  {{ end }}

  <!-- begin sponsor section -->
  {{- with .Params.sponsors -}}
    <hr />
  {{- end -}}
  {{ range $sponsor :=.Params.sponsors }}
    {{ if isset $.Site.Data.sponsors $sponsor }}
      {{ $s :=  (index $.Site.Data.sponsors $sponsor) }}
      <div class="flex flex-wrap -mx-4 mb-4 mt-4">
        <div class="w-full px-4">
          <a href = "{{ $s.url | absURL }}" target="_blank"><img alt = "{{ $sponsor }}" src = "{{ $s.ad | absURL }}" class="img-fluid"></a>
        </div>
      </div>
    {{ end }}
  {{ end }}
  {{- with .Params.sponsors -}}
    <hr />
  {{- end -}}
  <!-- end sponsor section -->

  <!-- sharing begins -->
  <div class="flex justify-center my-8">
    <div id="share"></div>
  </div>
  <!-- sharing ends -->

  {{ with .Site.Params.disqusShortname }}
    <!-- disqus begins -->
    <div class="row">
      <div class="col-md-12">
        {{ partial "disqus.html" }}
      </div>
    </div>
    <!-- disqus ends -->
  {{ end }}

  {{ with .Site.Params.giscus }}
    <!-- giscus begins -->
    <hr />
    <div class="row">
      <div class="col-md-12">
        {{ partial "giscus.html" }}
      </div>
    </div>
    <!-- giscus ends -->
  {{ end }}

  <div class="flex justify-center my-8">
    <nav aria-label="Episode navigation">
      <ul class="inline-flex items-center space-x-2">
        <li>
          {{ if .PrevInSection }}
            <a href="{{.PrevInSection.Permalink}}" class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md bg-white border border-castanet-primary-300 text-castanet-primary-700 hover:bg-castanet-primary-100 dark:bg-castanet-primary-800 dark:text-castanet-primary-200 dark:border-castanet-primary-700 dark:hover:bg-castanet-primary-700 transition">
              <span aria-hidden="true">&larr;</span>
              <span class="ml-2">Previous</span>
            </a>
          {{ else }}
            <span class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md bg-castanet-primary-100 border border-castanet-primary-200 text-castanet-primary-400 cursor-not-allowed dark:bg-castanet-primary-900 dark:border-castanet-primary-800">
              <span aria-hidden="true">&larr;</span>
              <span class="ml-2">Previous</span>
            </span>
          {{ end }}
        </li>
        <li>
          {{ if .NextInSection }}
            <a href="{{.NextInSection.Permalink}}" class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md bg-white border border-castanet-primary-300 text-castanet-primary-700 hover:bg-castanet-primary-100 dark:bg-castanet-primary-800 dark:text-castanet-primary-200 dark:border-castanet-primary-700 dark:hover:bg-castanet-primary-700 transition">
              <span class="mr-2">Next</span>
              <span aria-hidden="true">&rarr;</span>
            </a>
          {{ else }}
            <span class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md bg-castanet-primary-100 border border-castanet-primary-200 text-castanet-primary-400 cursor-not-allowed dark:bg-castanet-primary-900 dark:border-castanet-primary-800">
              <span class="mr-2">Next</span>
              <span aria-hidden="true">&rarr;</span>
            </span>
          {{ end }}
        </li>
      </ul>
    </nav>
  </div>

{{ end }}

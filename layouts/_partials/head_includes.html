<!------------ 
  The following logic allows for both the GA4 support using Google Tag Manager and the legacy UA Google Analytics tag
  to be used together. There may be situations where a organization support both tag methods simultaneously.
------------->
<!-- Check for the Global GoogleAnalytics variable to use the Hugo internal google_analytics template -->
{{ if .Site.Config.Services.GoogleAnalytics.ID }} {{ template "_internal/google_analytics.html" . }} {{ end }}
<!-- Check for googleAnalytics_UA param to use the google-analytics-ua partial -->
{{ if .Site.Params.googleAnalytics_UA }} {{ partial "google-analytics-ua.html" . }} {{ end }}

{{ if isset $.Site.Params "favicon"}}
<link rel="icon" href="{{ $.Site.Params.favicon | absURL }}">
{{ else }}
<link rel="icon" href="icons/favicon.ico">
{{ end }}
{{ if (fileExists "static/apple-touch-icon.png") -}}
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
{{- end}}
{{ if (fileExists "static/favicon-32x32.png") -}}
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
{{- end}}
{{ if (fileExists "static/favicon-16x16.png") -}}
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
{{- end}}
{{ if (fileExists "static/site.webmanifest") -}}
<link rel="manifest" href="/site.webmanifest">
{{- end}}
{{ if and (isset $.Site.Params.realfavicongenerator "mask_icon_color") (fileExists "static/safari-pinned-tab.svg") -}}
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="{{ $.Site.Params.realfavicongenerator.mask_icon_color}}">
{{- end}}
{{ if isset $.Site.Params.realfavicongenerator "msapplication_tilecolor" -}}
<meta name="msapplication-TileColor" content="{{ $.Site.Params.realfavicongenerator.msapplication_tilecolor}}">
{{- end}}
{{ if isset $.Site.Params.realfavicongenerator "theme_color" -}}
<meta name="theme-color" content="{{ $.Site.Params.realfavicongenerator.theme_color}}">
{{- end}}
<!-- {{ if isset $.Site.Params "site_theme"}}
<link href="{{ printf "css/%s.css" $.Site.Params.site_theme | absURL}}" rel="stylesheet">
{{ else }}
<link href={{"css/orange.css" | absURL }} rel="stylesheet">
{{ end }} -->

<!-- Tailwind CSS -->
{{/* Asset bundles */}}
{{ $assets := newScratch }}
{{ $algorithm := .Site.Params.fingerprintAlgorithm | default "sha256" }}
{{ $cssScheme := resources.Get (printf "css/schemes/%s.css" (lower .Site.Params.colorScheme | default "slate")) }}
{{ if not $cssScheme }}
  {{ $cssScheme = resources.Get "css/schemes/slate.css" }}
{{ end }}
{{ $assets.Add "css" (slice $cssScheme) }}
{{ $cssMain := resources.Get "css/compiled/main.css" }}
{{ $assets.Add "css" (slice $cssMain) }}
{{ $jssocials := resources.Get "lib/jssocials/css/jssocials.css" }}
{{ $jssocials_theme := resources.Get "lib/jssocials/css/jssocials-theme-plain.css" }}
{{ $fontawesome := resources.Get "lib/fontawesome/css/all.css" }}
{{ $assets.Add "css" (slice $jssocials $jssocials_theme $fontawesome) }}
{{ $cssCustom := resources.Get "css/custom.css" }}
{{ if $cssCustom }}
  {{ $assets.Add "css" (slice $cssCustom) }}
{{ end }}
{{ $bundleCSS := $assets.Get "css" | resources.Concat "css/main.bundle.css" | resources.Minify | resources.Fingerprint $algorithm }}
<link
  type="text/css"
  rel="stylesheet"
  href="{{ $bundleCSS.RelPermalink }}"
  integrity="{{ $bundleCSS.Data.Integrity }}"
/>

<link href="https://fonts.googleapis.com/css?family=Lato|Raleway" rel="stylesheet">
<!-- Custom CSS -->
{{ range .Site.Params.custom_css }}
    <link rel="stylesheet" href="{{ . | absURL }}">
{{ end }}
<!-- <link href={{"css/all.css" | absURL }} rel="stylesheet"> -->
<link href={{"css/mediaelementplayer.min.css" | absURL }} rel="stylesheet">
<style>
    .mejs__overlay-button {
        background-image: url("/img/mejs-controls.svg");
    }
    .mejs__overlay-loading-bg-img {
        background-image: url("/img/mejs-controls.svg");
    }
    .mejs__button > button {
        background-image: url("/img/mejs-controls.svg");
    }
    </style>
<link href={{"css/speed.min.css" | absURL }} rel="stylesheet">
{{ if eq .Section "blog" }}
    <link rel="alternate" type="application/rss+xml" title="{{$.Site.Title}}" href="{{"blog/index.xml" | absURL }}"/>
{{ else }}
    {{- if (isset $.Site.Params "rss_subscribe" ) -}}
        <link rel="alternate" type="application/rss+xml" title="{{$.Site.Title}}" href="{{$.Site.Params.rss_subscribe}}"/>
    {{- else -}}
        <link rel="alternate" type="application/rss+xml" title="{{$.Site.Title}}" href="{{"episode/index.xml" | absURL }}"/>
    {{- end -}}
{{ end }}
{{ $jquery := resources.Get "lib/jquery/jquery.js" }}
{{ $jssocials := resources.Get "lib/jssocials/jssocials.js" }}
{{ $mediaelement := resources.Get "lib/mediaelement/mediaelement-and-player.js" }}
{{ $speed := resources.Get "lib/mediaelement/speed.js" }}
{{ $speed_i18n := resources.Get "lib/mediaelement/speed-i18n.js" }}
{{ $castanet := resources.Get "js/castanet.js" }}

{{ $js := slice $jquery $jssocials $mediaelement $speed $speed_i18n $castanet | resources.Concat "js/castanet-min.js" | resources.Minify | resources.Fingerprint }}
<script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}"></script>
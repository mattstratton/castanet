<section class="episode-list">
<!-- rest of episodes -->
{{- if (where site.RegularPages "Type" "in" site.Params.mainSections) -}}
{{- $paginator := .Paginate (where ( where site.RegularPages "Type" "in" site.Params.mainSections) ".Params.upcoming" "==" true ) }}
{{- $list := (where ( where site.RegularPages "Type" "in" site.Params.mainSections) ".Params.upcoming" "==" true ) -}}
{{- $len := (len $list) -}}
<div class="flex flex-wrap -mx-4 main_container">
{{- with .Site.Params.enable_jumbo -}}
  {{- if eq . "true" -}}
    <div class="w-full px-4">
  {{- else -}}
    <div class="w-full md:w-2/3 px-4">
  {{- end -}}
{{- else -}}
  <div class="w-full md:w-2/3 px-4">
{{- end -}}
    {{- range $paginator.Pages.ByDate -}}
    {{- with .Params.truncate -}}
      {{- $.Scratch.Set "truncate" . }}
    {{- else -}}
      {{- with .Site.Params.truncate -}}
        {{- $.Scratch.Set "truncate" . }}
      {{- else -}}
        {{- $.Scratch.Set "truncate" 600 -}}
      {{- end -}}
    {{- end -}}
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
        <div class="w-full px-4">
          {{ if and (isset .Site.Params "episode_number_style") (.Params.episode) }}
            {{ if eq .Site.Params.episode_number_style "parens" }}            
              <h3 class="text-xl font-bold mb-2"><a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">{{ .Title }}</a> ({{ with .Site.Params.episode_number_prefix }}{{ . }}{{ end }}{{ .Params.episode }})</h3>
            {{ else if eq .Site.Params.episode_number_style "brackets" }}
              <h3 class="text-xl font-bold mb-2"><a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">{{ .Title }}</a> [{{ with .Site.Params.episode_number_prefix }}{{ . }}{{ end }}{{ .Params.episode }}]</h3>
            {{ else if eq .Site.Params.episode_number_style "dash" }}
              <h3 class="text-xl font-bold mb-2"><a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">{{ .Title }}</a> - {{ with .Site.Params.episode_number_prefix }}{{ . }}{{ end }}{{ .Params.episode }}</h3>
            {{ else }}
              <h3 class="text-xl font-bold mb-2"><a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">{{ .Title }}</a> ({{ with .Site.Params.episode_number_prefix }}{{ . }}{{ end }}{{ .Params.episode }})</h3>
            {{ end }}
          {{ else }}
            <h3 class="text-xl font-bold mb-2"><a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">{{ .Title }}</a></h3>
          {{ end }}          
          <div class="text-sm text-gray-600 dark:text-gray-400 mb-4">Scheduled for {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "episode-metadata.html" .}}</div>
        </div>
      </div>
      <div class="flex flex-wrap -mx-4 mb-8 homepage_episode_row">
      {{- if .Params.episode_image -}}
          <div class="w-full md:w-1/4 px-4 mb-4 md:mb-0">
            <a href="{{ .Permalink }}"><img class="w-full h-auto rounded-lg shadow" src="{{ .Params.episode_image | absURL }}" /></a>
          </div>
          <div class="w-full md:w-3/4 px-4">
          {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
            <p class="text-gray-700 dark:text-gray-300">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">Read More</a></p>
          {{- else -}}
            <p class="text-gray-700 dark:text-gray-300">{{ .Description | markdownify }}</p>
          {{- end -}}
          </div>
        {{- else -}}
          <div class="w-full px-4">
          {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
            <p class="text-gray-700 dark:text-gray-300">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">Read More</a></p>
          {{- else -}}
            <p class="text-gray-700 dark:text-gray-300">{{ .Description | markdownify }}</p>
          {{- end -}}
          </div>
        {{- end -}}
      </div>

    {{- end -}}
</div>

{{- if isset .Site.Params "enable_jumbo" -}}
  {{- if ne .Site.Params.enable_jumbo "true" -}}
    <div class="w-full md:w-1/3 px-4 sidebar_col">
      {{- partial "sidebar.html" . -}}
    </div>
  {{- end -}}
{{- else -}}
  <div class="w-full md:w-1/3 px-4 sidebar_col">
    {{- partial "sidebar.html" . -}}
  </div>
{{- end -}}

</div>
<div class="flex flex-wrap -mx-4">
<div class="w-full px-4">
{{- if gt $paginator.TotalPages 1 -}}
<div class="flex flex-wrap -mx-4">
<div class="w-full px-4">

<div class="flex justify-center my-8">
  <nav aria-label="Pagination">
    {{ $pag := $.Paginator }}
    {{ $window := $.Site.Params.paginateWindow | default 1 }}
    {{ if gt $pag.TotalPages 1 }}
      {{ $total := $pag.TotalPages }}
      {{ $size := add 5 (add $window $window) }}
      {{ $cur := $pag.PageNumber }}
      {{ if gt $total $size }}
        {{ if lt $cur (sub $size (add $window 1)) }}
          {{ $.Scratch.Set "show" (seq 1 (sub $size 2)) }}
        {{ else if lt (sub $total $cur) (sub $size (add $window 2)) }}
          {{ $.Scratch.Set "show" (seq (add (sub $total $size) 3) $total) }}
        {{ else }}
          {{ $.Scratch.Set "show" (seq (sub $cur $window) (add $cur $window)) }}
        {{ end }}
        {{ $.Scratch.Add "show" 1 }}
        {{ $.Scratch.Add "show" $total }}
      {{ else }}
        {{ $.Scratch.Set "show" (seq 1 $total) }}
      {{ end }}

      <ul class="inline-flex items-center space-x-2">
        <!-- first page button -->
        {{if $paginator.HasPrev }}
          {{ if gt $paginator.PageNumber 2 }}
              {{- with $paginator.First -}}
              {{- $url := trim (string .URL) "/" | absURL -}}
                  <li>
                  <a href="{{ $url }}" aria-label="First" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition"><span aria-hidden="true">&laquo;&laquo;</span></a>
                  </li>
              {{- end -}}
          {{ end }}
        {{ end }}

        <!-- prev page button -->
        {{- with $paginator.HasPrev -}}
            <li>
              <a href="{{ $paginator.Prev.URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition">&laquo;</a>
            </li>
        {{ end }}

        <!-- page # buttons -->
        {{ range $pag.Pagers }}
          {{ $cur := .PageNumber }}
          {{- $url := trim (string .URL) "/" | absURL -}}
          {{ if in ($.Scratch.Get "show") $cur }}
            <li>
              <a href="{{ .URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md border border-gray-300 dark:border-gray-700 {{ if eq . $pag }}bg-blue-600 text-white dark:bg-blue-500{{ else }}bg-white text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700{{ end }} transition">{{ .PageNumber }}</a>
            </li>
          {{ else if in (slice 2 (sub $total 1)) $cur }}
            <li>
              <span class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-gray-100 border border-gray-200 text-gray-400 dark:bg-gray-900 dark:border-gray-800">&hellip;</span>
            </li>
          {{ end }}
        {{ end }}

        <!-- next page button -->
        {{- with $paginator.HasNext -}}
        <li>
          <a href="{{ $paginator.Next.URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition">&raquo;</a>
        </li>
        {{ end }}

        <!-- last page button -->
        {{ if lt $paginator.PageNumber (sub $paginator.TotalPages 1) }}
          {{- with $paginator.Last -}}
              {{- $url := trim (string .URL) "/" | absURL -}}
                  <li>
                      <a href="{{ $url }}" aria-label="Last" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition"><span aria-hidden="true">&raquo;&raquo;</span></a>
                  </li>
          {{- end -}}
        {{ end }}
      </ul>
    {{ end }}
  </nav>
</div>
</div>
{{- end -}}
</div>
{{- end -}}
</div>
</div> <!-- end section -->

<div class="flex flex-wrap -mx-4 mb-6 hero_container">

  <div class="w-full px-4">
    <h2 class="text-3xl font-bold mb-4">Latest Blog Post</h2>

  {{ range first 1 ((where .Pages.ByDate "Section" "blog").Reverse) }}
    {{- with .Params.truncate -}}
      {{- $.Scratch.Set "truncate" . }}
    {{- else -}}
      {{- with .Site.Params.truncate -}}
        {{- $.Scratch.Set "truncate" . }}
      {{- else -}}
        {{- $.Scratch.Set "truncate" 600 -}}
      {{- end -}}
    {{- end -}}
    {{- with .Params.blog_banner -}}
      {{- $.Scratch.Set "blog_banner" "true" -}}
    {{- end -}}

    {{- if eq ($.Scratch.Get "blog_banner") "true" -}}
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
        <div class="w-full px-4">
          <a href="{{ .Permalink }}" class="row_latest_episode_title"><h2>{{ .Title }}</h2></a>
          <small>Posted on {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "blog-metadata.html" . }}</small>
        </div>
      </div>
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
        <div class="w-full px-4">
          <a href="{{ .Permalink }}"><img src="{{ .Params.blog_banner | absURL }}" class="img-fluid blog_image"/></a>
        </div>
      </div>
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
        <div class="w-full px-4">
          {{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<small><a href = "{{ .Permalink }}">Read More</a></small>
        </div>
      </div>
    {{- else -}}
    <!-- begin square row -->
    <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
      <div class="w-full px-4">
        <a href="{{ .Permalink }}" class="row_latest_episode_title"><h2>{{ .Title }}</h2></a>
        <small>Posted on {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "blog-metadata.html" .}}</small>
      </div>
    </div>
    {{- if .Params.blog_image -}}
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
        <div class="w-full md:w-1/4 px-4 mb-4 md:mb-0">
          <a href="{{ .Permalink }}"><img class="w-full h-auto rounded-lg shadow" src="{{ .Params.blog_image | absURL }}" /></a>
        </div>
        <div class="w-full md:w-3/4 px-4">
          {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
            <p class="hompage_episode_description">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<small><a href = "{{ .Permalink }}">Read More</a></small></p>
          {{- else -}}
            <p class="hompage_episode_description">{{ .Description | markdownify }}</p>
          {{- end -}}
        </div>
      </div><!-- end square row -->
    {{- else -}}
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
        <div class="w-full px-4">
        {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
          <p class="hompage_episode_description">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<small><a href = "{{ .Permalink }}">Read More</a></small></p>
        {{- else -}}
          <p class="hompage_episode_description">{{ .Description | markdownify }}</p>
        {{- end -}}
        </div>
      </div>
    {{- end -}}
  {{- end -}}

  {{- end -}}
  </div>
</div>

<section class="episode-list">
<!-- rest of episodes -->
{{- if (where .Pages.ByDate "Section" "blog") -}}
{{- $paginator := .Paginate (after 1 ((where .Pages.ByDate "Section" "blog").Reverse)) }}
{{- $list := (where .Pages.ByDate "Section" "blog") -}}
{{- $len := (len $list) -}}
<div class="flex flex-wrap -mx-4 main_container">

  <div class="w-full md:w-2/3 px-4">
{{- if gt $len 1 -}}
    {{- range $paginator.Pages -}}
    {{- with .Params.truncate -}}
      {{- $.Scratch.Set "truncate" . }}
    {{- else -}}
      {{- with .Site.Params.truncate -}}
        {{- $.Scratch.Set "truncate" . }}
      {{- else -}}
        {{- $.Scratch.Set "truncate" 600 -}}
      {{- end -}}
    {{- end -}}
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
        <div class="w-full px-4">
          <a href="{{ .Permalink }}" class="grid_episode_title"><h3 class="grid_episode_title">{{ .Title }}</h3></a>
          <small>Posted on {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "blog-metadata.html" .}}</small>
        </div>
      </div>
      <div class="flex flex-wrap -mx-4 mb-4 homepage_episode_row">
      {{- if .Params.blog_image -}}
          <div class="w-full md:w-1/4 px-4 mb-4 md:mb-0">
            <a href="{{ .Permalink }}"><img class="w-full h-auto rounded-lg shadow" src="{{ .Params.blog_image | absURL }}" /></a>
          </div>
          <div class="w-full md:w-3/4 px-4">
          {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
            <p class="hompage_episode_description">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<small><a href = "{{ .Permalink }}">Read More</a></small></p>
          {{- else -}}
            <p class="hompage_episode_description">{{ .Description | markdownify }}</p>
          {{- end -}}
          </div>
        {{- else -}}
          <div class="w-full px-4">
          {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
            <p class="hompage_episode_description">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<small><a href = "{{ .Permalink }}">Read More</a></small></p>
          {{- else -}}
            <p class="hompage_episode_description">{{ .Description | markdownify }}</p>
          {{- end -}}
          </div>
        {{- end -}}
      </div>
    {{- end -}}
  {{- end -}}
</div>

</div>
<div class="flex flex-wrap -mx-4">
<div class="w-full px-4">
{{- if gt $paginator.TotalPages 1 -}}
<div class="flex flex-wrap -mx-4">
<div class="w-full px-4">


<div class="flex justify-center my-8">
  <nav aria-label="Blog pagination">
    {{ $pag := $.Paginator }}
    {{ $window := $.Site.Params.paginateWindow | default 1 }}
    {{ if gt $pag.TotalPages 1 }}
      {{ $total := $pag.TotalPages }}
      {{ $size := add 5 (add $window $window) }}
      {{ $cur := $pag.PageNumber }}
      {{ if gt $total $size }}
        {{ if lt $cur (sub $size (add $window 1)) }}
          {{ $.Scratch.Set "show" (seq 1 (sub $size 2)) }}
        {{ else if lt (sub $total $cur) (sub $size (add $window 2)) }}
          {{ $.Scratch.Set "show" (seq (add (sub $total $size) 3) $total) }}
        {{ else }}
          {{ $.Scratch.Set "show" (seq (sub $cur $window) (add $cur $window)) }}
        {{ end }}
        {{ $.Scratch.Add "show" 1 }}
        {{ $.Scratch.Add "show" $total }}
      {{ else }}
        {{ $.Scratch.Set "show" (seq 1 $total) }}
      {{ end }}
      <ul class="inline-flex items-center space-x-2">
        <!-- first page button -->
        {{if $paginator.HasPrev }}
          {{ if gt $paginator.PageNumber 2 }}
              {{- with $paginator.First -}}
              {{- $url := trim (string .URL) "/" | absURL -}}
                  <li>
                  <a href="{{ $url }}" aria-label="First" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition"><span aria-hidden="true">&laquo;&laquo;</span></a>
                  </li>
              {{- end -}}
          {{ end }}
        {{ end }}
        <!-- prev page button -->
        {{- with $paginator.HasPrev -}}
            <li>
              <a href="{{ $paginator.Prev.URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition">&laquo;</a>
            </li>
        {{ end }}
        <!-- page # buttons -->
        {{ range $pag.Pagers }}
          {{ $cur := .PageNumber }}
          {{- $url := trim (string .URL) "/" | absURL -}}
          {{ if in ($.Scratch.Get "show") $cur }}
            <li>
              <a href="{{ .URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md border border-gray-300 dark:border-gray-700 {{ if eq . $pag }}bg-blue-600 text-white dark:bg-blue-500{{ else }}bg-white text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700{{ end }} transition">{{ .PageNumber }}</a>
            </li>
          {{ else if in (slice 2 (sub $total 1)) $cur }}
            <li>
              <span class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-gray-100 border border-gray-200 text-gray-400 dark:bg-gray-900 dark:border-gray-800">&hellip;</span>
            </li>
          {{ end }}
        {{ end }}
        <!-- next page button -->
        {{- with $paginator.HasNext -}}
        <li>
          <a href="{{ $paginator.Next.URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition">&raquo;</a>
        </li>
        {{ end }}
        <!-- last page button -->
        {{ if lt $paginator.PageNumber (sub $paginator.TotalPages 1) }}
          {{- with $paginator.Last -}}
              {{- $url := trim (string .URL) "/" | absURL -}}
                  <li>
                      <a href="{{ $url }}" aria-label="Last" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition"><span aria-hidden="true">&raquo;&raquo;</span></a>
                  </li>
          {{- end -}}
        {{ end }}
      </ul>
    {{ end }}
  </nav>
</div>
</div>
{{- end -}}
</div>
{{- end -}}
</div>
</div> <!-- end section -->

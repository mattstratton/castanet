<div class="w-full max-w-5xl mx-auto px-4 bg-castanet-primary-50 dark:bg-castanet-primary-900 rounded-lg shadow">

  <div class="mb-8 p-5">
    <h2 class="text-3xl font-bold text-castanet-primary-900 dark:text-white mb-4">Latest Blog Post</h2>

  {{ range first 1 ((where .Pages.ByDate "Section" "blog").Reverse) }}
    {{- with .Params.truncate -}}
      {{- $.Scratch.Set "truncate" . }}
    {{- else -}}
      {{- with .Site.Params.truncate -}}
        {{- $.Scratch.Set "truncate" . }}
      {{- else -}}
        {{- $.Scratch.Set "truncate" 600 -}}
      {{- end -}}
    {{- end -}}
    {{- with .Params.blog_banner -}}
      {{- $.Scratch.Set "blog_banner" "true" -}}
    {{- end -}}

    {{- if eq ($.Scratch.Get "blog_banner") "true" -}}
      <div class="mb-6">

          <a href="{{ .Permalink }}" class="text-castanet-primary-900 hover:text-blue-600 dark:text-white"><h2 class="text-2xl font-bold mb-2">{{ .Title }}</h2></a>
          <small class = "text-castanet-primary-600 dark:text-white">Posted on {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "blog-metadata.html" . }}</small>

      </div>
        <div class="mb-6">
          <a href="{{ .Permalink }}"><img src="{{ .Params.blog_banner | absURL }}" class="w-full h-auto rounded-lg shadow-lg"/></a>
        </div>
        <div class="mb-6">
          <p class="text-castanet-primary-700 dark:text-white">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-white text-sm">Read More</a></p>
        </div>
    {{- else -}}
    <!-- begin square row -->
      <div class="mb-6">
        <h2 class="text-2xl font-bold mb-2"><a href="{{ .Permalink }}" class="text-castanet-primary-900 hover:text-blue-600 dark:text-white">{{ .Title }}</a></h2>
        <p class="text-sm text-castanet-primary-600 dark:text-white mb-4">Posted on {{ dateFormat "Monday, Jan 2, 2006" .Date }} {{ partial "episode-metadata.html" .}}</p>
      </div>
    {{- if .Params.blog_image -}}
      <div class="flex flex-col md:flex-row gap-6 mb-6">
        <div class="md:w-1/4">
          <a href="{{ .Permalink }}"><img class="w-full h-auto rounded-lg shadow-md" src="{{ .Params.blog_image | absURL }}" /></a>
        </div>
        <div class="md:w-3/4">
          {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
            <p class="text-castanet-primary-700 dark:text-white">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-white text-sm">Read More</a></p>
          {{- else -}}
            <p class="text-castanet-primary-700 dark:text-white">{{ .Description | markdownify }}</p>
          {{- end -}}
        </div>
      </div><!-- end square row -->
    {{- else -}}
      <div class="mb-6">
        {{- if ge (countrunes .Description ) ($.Scratch.Get "truncate") -}}
          <p class="text-castanet-primary-700 dark:text-white">{{ .Description | markdownify | truncate ($.Scratch.Get "truncate") " "}}&nbsp;<a href="{{ .Permalink }}" class="text-blue-600 hover:text-blue-800 dark:text-white text-sm">Read More</a></p>
        {{- else -}}
          <p class="text-castanet-primary-700 dark:text-white">{{ .Description | markdownify }}</p>
        {{- end -}}
      </div>
    {{- end -}}
  {{- end -}}

  {{- end -}}
  </div>
</div>

<section class="w-full max-w-5xl mx-auto">
<!-- rest of episodes -->
{{- if (where .Pages.ByDate "Section" "blog") -}}
{{- $paginator := .Paginate (after 1 ((where .Pages.ByDate "Section" "blog").Reverse)) }}
{{- $list := (where .Pages.ByDate "Section" "blog") -}}
{{- $len := (len $list) -}}
<div class="flex flex-col lg:flex-row gap-8">

  <div class="w-full">
    {{- if gt $len 1 -}}
      {{- range $paginator.Pages -}}
        {{ partial "row/blog-row.html" . }}
      {{ end }}
    {{- end -}}
  </div>

</div>

{{- if gt $paginator.TotalPages 1 -}}

<div class="mt-8">
  <nav class="flex justify-center">
    {{ $pag := $.Paginator }}
    {{ $window := $.Site.Params.paginateWindow | default 1 }}
    {{ if gt $pag.TotalPages 1 }}
      {{ $total := $pag.TotalPages }}
      {{ $size := add 5 (add $window $window) }}
      {{ $cur := $pag.PageNumber }}
      {{ if gt $total $size }}
        {{ if lt $cur (sub $size (add $window 1)) }}
          {{ $.Scratch.Set "show" (seq 1 (sub $size 2)) }}
        {{ else if lt (sub $total $cur) (sub $size (add $window 2)) }}
          {{ $.Scratch.Set "show" (seq (add (sub $total $size) 3) $total) }}
        {{ else }}
          {{ $.Scratch.Set "show" (seq (sub $cur $window) (add $cur $window)) }}
        {{ end }}
        {{ $.Scratch.Add "show" 1 }}
        {{ $.Scratch.Add "show" $total }}
      {{ else }}
        {{ $.Scratch.Set "show" (seq 1 $total) }}
      {{ end }}
      <ul class="inline-flex items-center space-x-2">
        <!-- first page button -->
        {{if $paginator.HasPrev }}
          {{ if gt $paginator.PageNumber 2 }}
              {{- with $paginator.First -}}
              {{- $url := trim (string .URL) "/" | absURL -}}
                  <li>
                  <a href="{{ $url }}" aria-label="First" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition"><span aria-hidden="true">&laquo;&laquo;</span></a>
                  </li>
              {{- end -}}
          {{ end }}
        {{ end }}
        <!-- prev page button -->
        {{- with $paginator.HasPrev -}}
            <li>
              <a href="{{ $paginator.Prev.URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition">&laquo;</a>
            </li>
        {{ end }}
        <!-- page # buttons -->
        {{ range $pag.Pagers }}
          {{ $cur := .PageNumber }}
          {{- $url := trim (string .URL) "/" | absURL -}}
          {{ if in ($.Scratch.Get "show") $cur }}
            <li>
              <a href="{{ .URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md border border-gray-300 dark:border-gray-700 {{ if eq . $pag }}bg-blue-600 text-white dark:bg-blue-500{{ else }}bg-white text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700{{ end }} transition">{{ .PageNumber }}</a>
            </li>
          {{ else if in (slice 2 (sub $total 1)) $cur }}
            <li>
              <span class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-gray-100 border border-gray-200 text-gray-400 dark:bg-gray-900 dark:border-gray-800">&hellip;</span>
            </li>
          {{ end }}
        {{ end }}
        <!-- next page button -->
        {{- with $paginator.HasNext -}}
        <li>
          <a href="{{ $paginator.Next.URL }}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition">&raquo;</a>
        </li>
        {{ end }}
        <!-- last page button -->
        {{ if lt $paginator.PageNumber (sub $paginator.TotalPages 1) }}
          {{- with $paginator.Last -}}
              {{- $url := trim (string .URL) "/" | absURL -}}
                  <li>
                      <a href="{{ $url }}" aria-label="Last" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 transition"><span aria-hidden="true">&raquo;&raquo;</span></a>
                    </li>
                    {{- end -}}
                  {{ end }}
                </ul>
              {{ end }}
            </nav>
          </div>
          {{- end -}}
          {{- end -}}
        </section><!-- end section -->
